<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administra√ß√£o - Falc√µes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --bg-color: #0a0a0a; --card-color: #141414; --neon-green: #00e640;
            --text-color: #e0e0e0; --border-color: #222; --danger-color: #ff4444;
            --warning-color: #ffaa00; --info-color: #007bff; --money-color: #00d4ff;
        }

        body {
            font-family: 'Inter', 'Segoe UI', sans-serif; background-color: var(--bg-color); color: var(--text-color);
            margin: 0; padding: 0; display: flex; flex-direction: column; min-height: 100vh;
        }

        /* HEADER */
        .header { 
            display: flex; justify-content: space-between; align-items: center; 
            background: #000; padding: 12px 20px; border-bottom: 1px solid var(--border-color);
        }
        .logo-pequeno { height: 35px; filter: drop-shadow(0 0 5px var(--neon-green)); }
        
        /* MENU TABS */
        .menu-tabs { 
            display: flex; background: #000; padding: 8px 15px; gap: 8px;
            overflow-x: auto; border-bottom: 1px solid var(--border-color);
            scrollbar-width: none;
        }
        .tab-btn {
            background: transparent; border: 1px solid #222; color: #666;
            padding: 10px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; 
            transition: 0.3s; white-space: nowrap; display: flex; align-items: center; gap: 6px; font-size: 13px;
        }
        .tab-btn.ativo { background: var(--neon-green); color: black; border-color: var(--neon-green); box-shadow: 0 0 15px rgba(0, 230, 64, 0.2); }

        .container-principal { padding: 15px; flex: 1; max-width: 1400px; margin: 0 auto; width: 100%; box-sizing: border-box; }

        /* BUSCA */
        .search-box {
            width: 100%; padding: 10px; background: #000; border: 1px solid var(--border-color);
            border-radius: 8px; color: #fff; margin-bottom: 15px; font-size: 13px;
        }
        .search-box:focus { border-color: var(--neon-green); outline: none; }

        /* CARDS ESTAT√çSTICAS */
        .cards-resumo { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 25px; }
        @media (min-width: 768px) { .cards-resumo { grid-template-columns: repeat(4, 1fr); gap: 15px; } }

        .card-stat { background: var(--card-color); padding: 15px; border-radius: 12px; border: 1px solid var(--border-color); text-align: center; }
        .stat-valor { font-size: 20px; font-weight: 800; color: var(--neon-green); display: block; margin-top: 5px; }
        .stat-titulo { color: #888; font-size: 10px; text-transform: uppercase; font-weight: bold; }
        .card-faturamento { border-color: var(--money-color); }
        .card-faturamento .stat-valor { color: var(--money-color); }

        /* TABELA */
        .tabela-container { background: var(--card-color); border-radius: 12px; border: 1px solid var(--border-color); overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th { background-color: #000; color: var(--neon-green); font-size: 11px; padding: 12px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid var(--border-color); font-size: 13px; }

        /* GEST√ÉO */
        .painel-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
        @media (min-width: 900px) { .painel-grid { grid-template-columns: 1fr 1fr; } }
        .coluna { background: var(--card-color); padding: 20px; border-radius: 15px; border: 1px solid var(--border-color); }
        .card-user-gestao { background: #1f1f1f; padding: 12px; border-radius: 10px; margin-bottom: 10px; border-left: 3px solid var(--neon-green); }
        .user-name { font-weight: bold; font-size: 14px; color: #fff; display: block; }
    </style>
</head>
<body>

<div class="header">
    <img src="assets/logo.png" class="logo-pequeno">
    <div style="display: flex; align-items: center; gap: 15px;">
        <input type="month" id="filtro-data" class="search-box" style="margin-bottom: 0; width: auto; height: 35px;">
        <a href="index.html" style="color: var(--danger-color); text-decoration: none; font-weight: bold; font-size: 12px;">SAIR</a>
    </div>
</div>

<div class="menu-tabs">
    <button class="tab-btn ativo" onclick="mudarAba('dashboard', event)"><i class="fas fa-chart-line"></i> DASHBOARD</button>
    <button class="tab-btn" onclick="mudarAba('aprovacoes', event)"><i class="fas fa-user-clock"></i> APROVA√á√ïES</button>
    <button class="tab-btn" onclick="mudarAba('gerenciar', event)"><i class="fas fa-users-cog"></i> GEST√ÉO</button>
</div>

<div class="container-principal">
    
    <div id="dashboard" class="conteudo-aba ativo">
        <div class="cards-resumo">
            <div class="card-stat card-faturamento">
                <span class="stat-titulo">Faturamento Total</span>
                <span class="stat-valor" id="fat-total">R$ 0,00</span>
            </div>
            <div class="card-stat">
                <span class="stat-titulo">Moto T√°xi</span>
                <span class="stat-valor" id="fat-moto">R$ 0,00</span>
            </div>
            <div class="card-stat">
                <span class="stat-titulo">Entregas</span>
                <span class="stat-valor" id="fat-entrega">R$ 0,00</span>
            </div>
            <div class="card-stat">
                <span class="stat-titulo">Corridas</span>
                <span class="stat-valor" id="total-mes">0</span>
            </div>
        </div>
        <div class="tabela-container">
            <table>
                <thead><tr><th>ID</th><th>VALOR</th><th>LOCALIZA√á√ÉO</th><th>STATUS</th><th>PILOTO</th></tr></thead>
                <tbody id="tabela-historico"></tbody>
            </table>
        </div>
    </div>

    <div id="gerenciar" style="display:none;" class="conteudo-aba">
        <div class="painel-grid">
            <div class="coluna">
                <h3><i class="fas fa-motorcycle"></i> PILOTOS ATIVOS</h3>
                <input type="text" placeholder="Buscar piloto..." class="search-box" onkeyup="filtrarLista('container-motoboys-ativos', this.value)">
                <div id="container-motoboys-ativos"></div>
            </div>
            <div class="coluna">
                <h3><i class="fas fa-users"></i> CLIENTES ATIVOS</h3>
                <input type="text" placeholder="Buscar cliente..." class="search-box" onkeyup="filtrarLista('container-clientes-ativos', this.value)">
                <div id="container-clientes-ativos"></div>
            </div>
        </div>
    </div>

    </div>

<script>
    const MEU_IP = 'https://falcoes-app.onrender.com';
    let dadosDashboard = [];

    // Filtro de Busca
    function filtrarLista(containerId, termo) {
        const cards = document.getElementById(containerId).getElementsByClassName('card-user-gestao');
        const busca = termo.toLowerCase();
        for (let card of cards) {
            const nome = card.innerText.toLowerCase();
            card.style.display = nome.includes(busca) ? 'block' : 'none';
        }
    }

    async function carregarDashboard() {
        try {
            const res = await fetch(`${MEU_IP}/admin/dashboard`);
            const data = await res.json();
            dadosDashboard = data.historico;

            // C√°lculos
            const concluida = data.historico.filter(c => c.status === 'concluida');
            const total = concluida.reduce((acc, c) => acc + parseFloat(c.valor), 0);
            const moto = concluida.filter(c => c.tipo_servico === 'moto-taxi').reduce((acc, c) => acc + parseFloat(c.valor), 0);
            const entrega = concluida.filter(c => c.tipo_servico === 'entrega').reduce((acc, c) => acc + parseFloat(c.valor), 0);

            document.getElementById('fat-total').innerText = total.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'});
            document.getElementById('fat-moto').innerText = moto.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'});
            document.getElementById('fat-entrega').innerText = entrega.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'});
            document.getElementById('total-mes').innerText = data.total_mes;

            const tbody = document.getElementById('tabela-historico');
            tbody.innerHTML = data.historico.map(c => `
                <tr>
                    <td style="color:#666">#${c.id}</td>
                    <td style="font-weight:bold; color:var(--neon-green)">R$ ${parseFloat(c.valor).toFixed(2)}</td>
                    <td>üìç ${c.origem.split(',')[0]}<br><small style="color:#666">üèÅ ${c.destino.split(',')[0]}</small></td>
                    <td><span class="status-tag status-${c.status}">${c.status}</span></td>
                    <td>${c.nome_motoboy || '---'}</td>
                </tr>
            `).join('');
        } catch (err) { console.error(err); }
    }

    // Fun√ß√µes de gest√£o (motoboys/clientes) permanecem as mesmas, chamando as rotas da API
    // ... (inclua as fun√ß√µes carregarMotoboysAtivos, carregarClientes e mudarAba do c√≥digo anterior)

    // Define m√™s atual no filtro ao carregar
    document.getElementById('filtro-data').value = new Date().toISOString().slice(0, 7);
    carregarDashboard();
</script>
</body>
</html>