<!DOCTYPE html> <html lang="pt-br"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Administra√ß√£o - Falc√µes</title> <style> :root { --bg-color: #121212; --card-color: #1e1e1e; --neon-green: #00e640; --text-color: #ffffff; --border-color: #333; --danger-color: #ff4444; --warning-color: #ffaa00; } body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg-color); color: var(--text-color); padding: 20px; margin: 0; }


    .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 20px; margin-bottom: 20px; }
    .logo-pequeno { height: 50px; }
    
    .menu-tabs { display: flex; gap: 10px; margin-bottom: 30px; }
    .tab-btn {
        background: transparent; border: 1px solid var(--border-color); color: #aaa;
        padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s;
    }
    .tab-btn.ativo { background: var(--neon-green); color: black; border-color: var(--neon-green); }
    .tab-btn:hover { border-color: var(--neon-green); }

    .conteudo-aba { display: none; animation: fadeIn 0.5s; }
    .conteudo-aba.ativo { display: block; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .cards-resumo { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .card-stat { 
        background: var(--card-color); padding: 20px; border-radius: 10px; 
        border: 1px solid var(--border-color); text-align: center;
    }
    .stat-valor { font-size: 32px; font-weight: 800; color: var(--neon-green); display: block; margin-top: 10px; }
    .stat-titulo { color: #aaa; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }

    table { width: 100%; border-collapse: collapse; background: var(--card-color); border-radius: 10px; overflow: hidden; font-size: 14px; }
    th, td { padding: 15px; text-align: left; border-bottom: 1px solid var(--border-color); }
    th { background-color: #000; color: var(--neon-green); text-transform: uppercase; }
    tr:hover { background-color: #252525; }
    .tipo-tag { padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; text-transform: uppercase; }
    .tag-moto { background: #ffd700; color: black; }
    .tag-entrega { background: #00e640; color: black; }

    .painel-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .coluna { background: #181818; padding: 20px; border-radius: 15px; border: 1px solid var(--border-color); min-height: 400px; }
    .coluna h3 { border-bottom: 2px solid #333; padding-bottom: 10px; margin-top: 0; text-align: center; color: var(--neon-green); } 
    .card-usuario { background: var(--card-color); padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid var(--border-color); }
    .nome { font-size: 18px; font-weight: bold; color: white; }
    .info { font-size: 14px; color: #aaa; margin-top: 5px; }
    .destaque { color: var(--neon-green); font-weight: bold; }
    .acoes { display: flex; gap: 10px; margin-top: 15px; }
    button { flex: 1; padding: 8px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; transition: 0.2s; }
    .btn-aprovar { background-color: var(--neon-green); color: black; }
    .btn-rejeitar { border: 1px solid var(--danger-color); background: transparent; color: var(--danger-color); }
    .btn-remover { background-color: var(--danger-color); color: white; flex: none; width: 40px; }

    .vazio { text-align: center; color: #555; margin-top: 50px; }
    .tabela-gestao td { vertical-align: middle; }

    </style>
</head>
text
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker
    .register("/service-worker.js")
    .then(() => console.log("SW registrado!"))
    .catch(err => console.log("Erro SW:", err));
}
</script>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00e640"> 
<body>
    
</style>

</head> <body>
text

>>>>>>> fcc90e8 (Atualiza√ß√µes)
<div class="header">
    <img src="assets/logo.png" class="logo-pequeno">
    <h2 style="margin:0; color: var(--neon-green);">PAINEL CHEFE</h2>
    <a href="index.html" style="color: var(--danger-color); text-decoration: none;">Sair</a>
</div>

<div class="menu-tabs">
    <button class="tab-btn ativo" onclick="mudarAba('dashboard', event)">üìä DASHBOARD</button>
    <button class="tab-btn" onclick="mudarAba('aprovacoes', event)">üë• APROVA√á√ïES</button>
    <button class="tab-btn" onclick="mudarAba('gerenciar', event)">‚öôÔ∏è GERENCIAR USU√ÅRIOS</button>
</div>

<div id="dashboard" class="conteudo-aba ativo">
    <div class="cards-resumo">
        <div class="card-stat">
            <span class="stat-titulo">Corridas Hoje</span>
            <span class="stat-valor" id="total-hoje">0</span>
        </div>
        <div class="card-stat">
            <span class="stat-titulo">Corridas no M√™s</span>
            <span class="stat-valor" id="total-mes">0</span>
        </div>
        <div class="card-stat">
            <span class="stat-titulo">Entregas</span>
            <span class="stat-valor" id="qtd-entrega" style="color:#fff">0</span>
        </div>
        <div class="card-stat">
            <span class="stat-titulo">Moto T√°xi</span>
            <span class="stat-valor" id="qtd-moto" style="color:#fff">0</span>
        </div>
    </div>

    <h3 style="color: #ddd; border-bottom: 1px solid #333; padding-bottom: 10px;">√öLTIMOS PEDIDOS</h3>
    
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>TIPO</th>
                <th>VALOR</th>
                <th>ORIGEM / DESTINO</th>
                <th>STATUS</th>
                <th>MOTIVO/OBS</th>
                <th>MOTOBOY</th>
            </tr>
        </thead>
        <tbody id="tabela-historico"></tbody>
    </table>
</div>

<div id="aprovacoes" class="conteudo-aba">
    <div class="painel-grid">
        <div class="coluna">
            <h3>CLIENTES PENDENTES</h3>
            <div id="lista-clientes">
                <div class="vazio">Nenhum cliente pendente (Aprova√ß√£o autom√°tica no servidor).</div>
            </div>
        </div>
        <div class="coluna">
            <h3>PILOTOS PENDENTES</h3>
            <div id="lista-motoboys">Carregando...</div>
        </div>
    </div>
</div>

<div id="gerenciar" class="conteudo-aba">
    <div class="painel-grid">
        <div class="coluna">
            <h3>MOTOBYS CADASTRADOS (Ativos)</h3>
            <table class="tabela-gestao">
                <thead>
                    <tr>
                        <th>Nome / Contato</th>
                        <th>Moto / Categoria</th>
                        <th>A√ß√£o</th>
                    </tr>
                </thead>
                <tbody id="tabela-motoboys-ativos"></tbody>
            </table>
        </div>

        <div class="coluna">
            <h3>CLIENTES CADASTRADOS</h3>
            <table class="tabela-gestao">
                <thead>
                    <tr>
                        <th>Nome / Contato</th>
                        <th>A√ß√£o</th>
                    </tr>
                </thead>
                <tbody id="tabela-clientes-ativos"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const MEU_IP = 'https://falcoes-app.onrender.com';

    const usuario = JSON.parse(localStorage.getItem('usuario'));
    if (!usuario || usuario.tipo !== 'admin') {
        window.location.href = 'index.html';
    }

    function mudarAba(aba, event) {
        document.querySelectorAll('.conteudo-aba').forEach(el => el.classList.remove('ativo'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('ativo'));
        
        document.getElementById(aba).classList.add('ativo');
        const btn = event && event.target.closest('.tab-btn');
        if (btn) btn.classList.add('ativo');

        if (aba === 'dashboard') carregarDashboard();
        if (aba === 'aprovacoes') carregarPendentes();
        if (aba === 'gerenciar') {
            carregarMotoboysAtivos();
            carregarClientes();
        }
    }

    async function carregarDashboard() {
        try {
            const res = await fetch(`${MEU_IP}/admin/dashboard`);
            const data = await res.json();

            document.getElementById('total-hoje').innerText = data.total_hoje;
            document.getElementById('total-mes').innerText = data.total_mes;
            document.getElementById('qtd-entrega').innerText = data.qtd_entrega;
            document.getElementById('qtd-moto').innerText = data.qtd_moto;

            const tbody = document.getElementById('tabela-historico');
            tbody.innerHTML = '';

            data.historico.forEach(c => {
                const classeTipo = c.tipo_servico === 'moto-taxi' ? 'tag-moto' : 'tag-entrega';
                const nomeMoto = c.nome_motoboy ? c.nome_motoboy.split(' ') : '<span style="color:#555">--</span>';
                
                let statusCor = 'white';
                if (c.status === 'pendente') statusCor = 'orange';
                if (c.status === 'aceita') statusCor = '#00e640';
                if (c.status === 'concluida') statusCor = '#007bff';
                if (c.status === 'cancelada') statusCor = '#ff4444';

                const motivo = c.status === 'cancelada' && c.motivo_cancelamento ?
                    `<span style="color:#ff4444; font-size:11px;">${c.motivo_cancelamento}</span>` : '-';

                const row = `
                    <tr>
                        <td>#${c.id}</td>
                        <td><span class="tipo-tag ${classeTipo}">${c.tipo_servico}</span></td>
                        <td style="color:var(--neon-green); font-weight:bold;">R$ ${c.valor}</td>
                        <td>
                            <div style="font-size:12px; color:#ccc">üìç ${c.origem.split(',')}</div>
                            <div style="font-size:12px; color:#ccc">üèÅ ${c.destino.split(',')}</div>
                        </td>
                        <td style="color:${statusCor}; font-weight:bold; text-transform:uppercase">${c.status}</td>
                        <td>${motivo}</td>
                        <td>${nomeMoto}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

        } catch (err) { console.error(err); }
    }

    async function carregarPendentes() {
        try {
            const response = await fetch(`${MEU_IP}/admin/pendentes`);
            const usuarios = await response.json();
            
            document.getElementById('lista-clientes').innerHTML = '<div class="vazio">Nenhum cliente pendente (Aprova√ß√£o autom√°tica no servidor).</div>';
            
            const divMotoboys = document.getElementById('lista-motoboys');
            divMotoboys.innerHTML = '';

            let cm = 0;

            usuarios.forEach(user => {
                if (user.tipo === 'motoboy') {
                    cm++; divMotoboys.innerHTML += criarCardAprovacao(user);
                }
            });

            if (cm === 0) divMotoboys.innerHTML = '<div class="vazio">Nenhum pendente.</div>';

        } catch (err) { console.error(err); }
    }

    function criarCardAprovacao(u) {
        const extra = u.tipo === 'motoboy' ?
            `<div class="info">üèçÔ∏è ${u.modelo_moto} | ${u.placa}</div>
             <div class="info">üé® ${u.cor_moto}</div>
             <div class="info" style="margin-top:5px; color:#ffd700; font-size:11px; border:1px solid #ffd700; padding:2px 5px; display:inline-block; border-radius:4px;">${u.categoria}</div>`
            : '';
        
        return `
            <div class="card-usuario">
                <div class="nome">${u.nome}</div>
                <div class="info">üìû ${u.telefone}</div>
                ${extra}
                <div class="acoes">
                    <button class="btn-rejeitar" onclick="decisao(${u.id}, 'rejeitar')">REJEITAR</button>
                    <button class="btn-aprovar" onclick="decisao(${u.id}, 'aprovar')">APROVAR</button>
                </div>
            </div>
        `;
    }

    async function decisao(id, acao) {
        if (!confirm(`Confirma ${acao}?`)) return;
        const url = acao === 'aprovar' ? '/admin/aprovar' : '/admin/rejeitar';
        try {
            const res = await fetch(`${MEU_IP}${url}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id })
            });
            const data = await res.json();
            if (data.success) {
                carregarPendentes();
                if (document.getElementById('gerenciar').classList.contains('ativo')) {
                    carregarMotoboysAtivos();
                }
            } else {
                alert(`Falha na opera√ß√£o: ${data.message || 'Erro desconhecido.'}`);
            }
        } catch (err) { alert("Erro de conex√£o"); }
    }

    async function carregarMotoboysAtivos() {
        const tbody = document.getElementById('tabela-motoboys-ativos');
        tbody.innerHTML = `<tr><td colspan="3" class="vazio">Carregando Motoboys...</td></tr>`;
        try {
            const res = await fetch(`${MEU_IP}/admin/motoboys`);
            const motoboys = await res.json();

            tbody.innerHTML = '';
            if (motoboys.length === 0) {
                tbody.innerHTML = `<tr><td colspan="3" class="vazio">Nenhum Motoboy ativo encontrado.</td></tr>`;
                return;
            }

            motoboys.forEach(m => {
                const row = `
                    <tr>
                        <td>
                            <div class="nome">${m.nome} (#${m.id})</div>
                            <div class="info">üìß ${m.email}</div>
                            <div class="info">üìû ${m.telefone}</div>
                        </td>
                        <td>
                            <div class="info">üèçÔ∏è ${m.modelo_moto} | ${m.placa}</div>
                            <div class="info" style="color:#ffd700; font-weight:bold;">Cat: ${m.categoria}</div>
                        </td>
                        <td>
                            <button class="btn-remover" title="Remover permanentemente" onclick="removerUsuario(${m.id})">‚ùå</button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

        } catch (err) {
            tbody.innerHTML = `<tr><td colspan="3" class="vazio" style="color:var(--danger-color)">Erro ao carregar Motoboys.</td></tr>`;
            console.error(err);
        }
    }

    async function carregarClientes() {
        const tbody = document.getElementById('tabela-clientes-ativos');
        tbody.innerHTML = `<tr><td colspan="2" class="vazio">Carregando Clientes...</td></tr>`;
        try {
            const res = await fetch(`${MEU_IP}/admin/clientes`);
            const clientes = await res.json();

            tbody.innerHTML = '';
            if (clientes.length === 0) {
                tbody.innerHTML = `<tr><td colspan="2" class="vazio">Nenhum Cliente encontrado.</td></tr>`;
                return;
            }

            clientes.forEach(c => {
                const row = `
                    <tr>
                        <td>
                            <div class="nome">${c.nome} (#${c.id})</div>
                            <div class="info">üìß ${c.email}</div>
                            <div class="info">üìû ${c.telefone}</div>
                        </td>
                        <td>
                            <button class="btn-remover" title="Remover permanentemente" onclick="removerUsuario(${c.id})">‚ùå</button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

        } catch (err) {
            tbody.innerHTML = `<tr><td colspan="2" class="vazio" style="color:var(--danger-color)">Erro ao carregar Clientes.</td></tr>`;
            console.error(err);
        }
    }

    async function removerUsuario(id) {
        if (!confirm(`‚ö†Ô∏è ATEN√á√ÉO: Confirma a REMO√á√ÉO PERMANENTE do usu√°rio ID ${id}? Todas as corridas associadas a ele ser√£o afetadas.`)) return;

        try {
            const res = await fetch(`${MEU_IP}/admin/remover/${id}`, {
                method: 'DELETE',
            });
            const data = await res.json();

            if (data.success) {
                alert('Usu√°rio removido com sucesso!');
                carregarMotoboysAtivos();
                carregarClientes();
            } else {
                alert(`Falha ao remover: ${data.message || 'Erro desconhecido.'}`);
            }
        } catch (err) {
            alert("Erro de conex√£o ao tentar remover o usu√°rio.");
            console.error(err);
        }
    }

    carregarDashboard();
</script>

</body> </html>
>>>>>>> fcc90e8 (Atualiza√ß√µes)
