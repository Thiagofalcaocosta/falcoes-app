<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administra√ß√£o - Falc√µes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --bg-color: #0f0f0f; --card-color: #1a1a1a; --neon-green: #00e640;
            --text-color: #ffffff; --border-color: #2a2a2a; --danger-color: #ff4444;
            --warning-color: #ffaa00; --info-color: #007bff;
        }

        body {
            font-family: 'Segoe UI', sans-serif; background-color: var(--bg-color); color: var(--text-color);
            margin: 0; padding: 0; display: flex; flex-direction: column; min-height: 100vh;
        }

        /* HEADER */
        .header { 
            display: flex; justify-content: space-between; align-items: center; 
            background: #000; padding: 15px 25px; border-bottom: 1px solid var(--border-color);
        }
        .logo-pequeno { height: 45px; filter: drop-shadow(0 0 5px var(--neon-green)); }
        
        /* MENU TABS */
        .menu-tabs { 
            display: flex; background: #000; padding: 10px 20px; gap: 10px;
            overflow-x: auto; border-bottom: 1px solid var(--border-color);
        }
        .tab-btn {
            background: transparent; border: 1px solid #333; color: #888;
            padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: bold; 
            transition: 0.3s; white-space: nowrap; display: flex; align-items: center; gap: 8px;
        }
        .tab-btn i { font-size: 16px; }
        .tab-btn.ativo { background: var(--neon-green); color: black; border-color: var(--neon-green); }
        .tab-btn:hover:not(.ativo) { border-color: var(--neon-green); color: var(--neon-green); }

        .container-principal { padding: 25px; flex: 1; }
        .conteudo-aba { display: none; animation: fadeIn 0.4s ease; }
        .conteudo-aba.ativo { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* CARDS ESTAT√çSTICAS */
        .cards-resumo { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card-stat { 
            background: var(--card-color); padding: 25px; border-radius: 15px; 
            border: 1px solid var(--border-color); text-align: center; transition: 0.3s;
        }
        .card-stat:hover { border-color: var(--neon-green); transform: translateY(-5px); }
        .stat-valor { font-size: 36px; font-weight: 800; color: var(--neon-green); display: block; margin-top: 10px; }
        .stat-titulo { color: #888; font-size: 13px; text-transform: uppercase; letter-spacing: 1px; font-weight: bold; }

        /* TABELAS */
        .tabela-container { background: var(--card-color); border-radius: 15px; border: 1px solid var(--border-color); overflow: hidden; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { background-color: #000; color: var(--neon-green); text-transform: uppercase; padding: 15px; text-align: left; border-bottom: 2px solid var(--border-color); }
        td { padding: 15px; border-bottom: 1px solid var(--border-color); vertical-align: middle; }
        tr:hover { background-color: rgba(255, 255, 255, 0.03); }

        /* TAGS DE STATUS */
        .status-tag { padding: 5px 10px; border-radius: 6px; font-size: 11px; font-weight: 800; text-transform: uppercase; }
        .status-pendente { background: rgba(255, 170, 0, 0.15); color: var(--warning-color); border: 1px solid var(--warning-color); }
        .status-concluida { background: rgba(0, 123, 255, 0.15); color: var(--info-color); border: 1px solid var(--info-color); }
        .status-cancelada { background: rgba(255, 68, 68, 0.15); color: var(--danger-color); border: 1px solid var(--danger-color); }
        .status-aceita { background: rgba(0, 230, 64, 0.15); color: var(--neon-green); border: 1px solid var(--neon-green); }

        /* GEST√ÉO DE USU√ÅRIOS */
        .painel-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px; }
        .coluna { background: var(--card-color); padding: 25px; border-radius: 20px; border: 1px solid var(--border-color); }
        .coluna h3 { color: var(--neon-green); margin-top: 0; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #333; padding-bottom: 15px; margin-bottom: 20px; }
        
        .card-user-gestao { 
            background: #252525; padding: 15px; border-radius: 12px; margin-bottom: 15px; 
            border-left: 4px solid var(--neon-green); position: relative;
        }
        .user-info { margin-bottom: 10px; }
        .user-name { font-weight: bold; font-size: 16px; color: #fff; display: block; }
        .user-sub { font-size: 13px; color: #888; display: block; margin-top: 4px; }
        
        .btn-acao { 
            padding: 8px 15px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; gap: 5px;
        }
        .btn-aprove { background: var(--neon-green); color: #000; }
        .btn-deny { background: transparent; border: 1px solid var(--danger-color); color: var(--danger-color); }
        .btn-del { position: absolute; right: 15px; top: 15px; color: #555; background: none; border: none; cursor: pointer; }
        .btn-del:hover { color: var(--danger-color); }

        .vazio { text-align: center; color: #555; padding: 40px; font-style: italic; }
    </style>
</head>

<body>

<div class="header">
    <img src="assets/logo.png" class="logo-pequeno">
    <div style="text-align: right;">
        <span style="display: block; font-size: 12px; color: #666;">LOGADO COMO ADM</span>
        <a href="index.html" style="color: var(--danger-color); text-decoration: none; font-weight: bold; font-size: 14px;">SAIR <i class="fas fa-sign-out-alt"></i></a>
    </div>
</div>

<div class="menu-tabs">
    <button class="tab-btn ativo" onclick="mudarAba('dashboard', event)"><i class="fas fa-chart-line"></i> DASHBOARD</button>
    <button class="tab-btn" onclick="mudarAba('aprovacoes', event)"><i class="fas fa-user-clock"></i> APROVA√á√ïES</button>
    <button class="tab-btn" onclick="mudarAba('gerenciar', event)"><i class="fas fa-users-cog"></i> GEST√ÉO DE USU√ÅRIOS</button>
</div>

<div class="container-principal">
    
    <div id="dashboard" class="conteudo-aba ativo">
        <div class="cards-resumo">
            <div class="card-stat">
                <span class="stat-titulo">Corridas Hoje</span>
                <span class="stat-valor" id="total-hoje">0</span>
            </div>
            <div class="card-stat">
                <span class="stat-titulo">Corridas M√™s</span>
                <span class="stat-valor" id="total-mes">0</span>
            </div>
            <div class="card-stat">
                <span class="stat-titulo">Total Entregas</span>
                <span class="stat-valor" id="qtd-entrega" style="color:#fff">0</span>
            </div>
            <div class="card-stat">
                <span class="stat-titulo">Total Moto T√°xi</span>
                <span class="stat-valor" id="qtd-moto" style="color:#fff">0</span>
            </div>
        </div>

        <h3 style="color: #ddd; margin-bottom: 15px;"><i class="fas fa-history"></i> √öLTIMOS PEDIDOS</h3>
        <div class="tabela-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>TIPO</th>
                        <th>VALOR</th>
                        <th>LOCALIZA√á√ÉO (ORIGEM > DESTINO)</th>
                        <th>STATUS</th>
                        <th>PILOTO</th>
                    </tr>
                </thead>
                <tbody id="tabela-historico"></tbody>
            </table>
        </div>
    </div>

    <div id="aprovacoes" class="conteudo-aba">
        <div class="painel-grid">
            <div class="coluna">
                <h3><i class="fas fa-user-check"></i> CLIENTES PENDENTES</h3>
                <div id="lista-clientes"><div class="vazio">Aprova√ß√£o autom√°tica ativada.</div></div>
            </div>
            <div class="coluna">
                <h3><i class="fas fa-motorcycle"></i> PILOTOS PENDENTES</h3>
                <div id="lista-motoboys">Carregando...</div>
            </div>
        </div>
    </div>

    <div id="gerenciar" class="conteudo-aba">
        <div class="painel-grid">
            <div class="coluna">
                <h3><i class="fas fa-user-shield"></i> PILOTOS ATIVOS</h3>
                <div id="container-motoboys-ativos"></div>
            </div>
            <div class="coluna">
                <h3><i class="fas fa-users"></i> CLIENTES CADASTRADOS</h3>
                <div id="container-clientes-ativos"></div>
            </div>
        </div>
    </div>

</div>

<script>
    const MEU_IP = 'https://falcoes-app.onrender.com';
    const usuarioLogado = JSON.parse(localStorage.getItem('usuario'));

    if (!usuarioLogado || usuarioLogado.tipo !== 'admin') window.location.href = 'index.html';

    function mudarAba(aba, event) {
        document.querySelectorAll('.conteudo-aba').forEach(el => el.classList.remove('ativo'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('ativo'));
        document.getElementById(aba).classList.add('ativo');
        event.target.closest('.tab-btn').classList.add('ativo');

        if (aba === 'dashboard') carregarDashboard();
        if (aba === 'aprovacoes') carregarPendentes();
        if (aba === 'gerenciar') { carregarMotoboysAtivos(); carregarClientes(); }
    }

    async function carregarDashboard() {
        try {
            const res = await fetch(`${MEU_IP}/admin/dashboard`);
            const data = await res.json();

            document.getElementById('total-hoje').innerText = data.total_hoje;
            document.getElementById('total-mes').innerText = data.total_mes;
            document.getElementById('qtd-entrega').innerText = data.qtd_entrega;
            document.getElementById('qtd-moto').innerText = data.qtd_moto;

            const tbody = document.getElementById('tabela-historico');
            tbody.innerHTML = '';

            data.historico.forEach(c => {
                let statusClass = `status-${c.status}`;
                tbody.innerHTML += `
                    <tr>
                        <td style="font-weight:bold; color:#888;">#${c.id}</td>
                        <td><span style="font-size:11px; font-weight:bold; color:var(--neon-green)">${c.tipo_servico.toUpperCase()}</span></td>
                        <td style="color:var(--neon-green); font-weight:bold;">R$ ${c.valor}</td>
                        <td>
                            <div style="font-size:12px; color:#fff">üìç ${c.origem.split(',')[0]}</div>
                            <div style="font-size:12px; color:#888">üèÅ ${c.destino.split(',')[0]}</div>
                        </td>
                        <td><span class="status-tag ${statusClass}">${c.status}</span></td>
                        <td style="font-size:13px;">${c.nome_motoboy || '<span style="color:#444">Aguardando...</span>'}</td>
                    </tr>
                `;
            });
        } catch (err) { console.error(err); }
    }

    async function carregarPendentes() {
        try {
            const res = await fetch(`${MEU_IP}/admin/pendentes`);
            const users = await res.json();
            const divMoto = document.getElementById('lista-motoboys');
            divMoto.innerHTML = '';
            
            const pendentes = users.filter(u => u.tipo === 'motoboy');
            if(pendentes.length === 0) divMoto.innerHTML = '<div class="vazio">Nenhum piloto aguardando.</div>';
            
            pendentes.forEach(u => {
                divMoto.innerHTML += `
                    <div class="card-user-gestao">
                        <span class="user-name">${u.nome}</span>
                        <span class="user-sub"><i class="fas fa-phone"></i> ${u.telefone}</span>
                        <span class="user-sub"><i class="fas fa-motorcycle"></i> ${u.modelo_moto} (${u.placa})</span>
                        <div style="display:flex; gap:10px; margin-top:15px;">
                            <button class="btn-acao btn-aprove" onclick="decisao(${u.id}, 'aprovar')">APROVAR</button>
                            <button class="btn-acao btn-deny" onclick="decisao(${u.id}, 'rejeitar')">REJEITAR</button>
                        </div>
                    </div>
                `;
            });
        } catch (e) { console.error(e); }
    }

    async function carregarMotoboysAtivos() {
        const div = document.getElementById('container-motoboys-ativos');
        try {
            const res = await fetch(`${MEU_IP}/admin/motoboys`);
            const data = await res.json();
            div.innerHTML = data.map(m => `
                <div class="card-user-gestao">
                    <button class="btn-del" onclick="removerUsuario(${m.id})"><i class="fas fa-trash"></i></button>
                    <span class="user-name">${m.nome} (#${m.id})</span>
                    <span class="user-sub">${m.email}</span>
                    <span class="user-sub" style="color:var(--neon-green)">Cat: ${m.categoria}</span>
                </div>
            `).join('');
        } catch (e) { div.innerHTML = "Erro ao carregar."; }
    }

    async function carregarClientes() {
        const div = document.getElementById('container-clientes-ativos');
        try {
            const res = await fetch(`${MEU_IP}/admin/clientes`);
            const data = await res.json();
            div.innerHTML = data.map(c => `
                <div class="card-user-gestao" style="border-left-color: #888;">
                    <button class="btn-del" onclick="removerUsuario(${c.id})"><i class="fas fa-trash"></i></button>
                    <span class="user-name">${c.nome} (#${c.id})</span>
                    <span class="user-sub">${c.telefone}</span>
                </div>
            `).join('');
        } catch (e) { div.innerHTML = "Erro ao carregar."; }
    }

    async function decisao(id, acao) {
        if(!confirm(`Confirma ${acao}?`)) return;
        const res = await fetch(`${MEU_IP}/admin/${acao === 'aprovar' ? 'aprovar' : 'rejeitar'}`, {
            method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ id })
        });
        if((await res.json()).success) carregarPendentes();
    }

    async function removerUsuario(id) {
        if(!confirm("‚ö†Ô∏è REMOVER PERMANENTEMENTE?")) return;
        const res = await fetch(`${MEU_IP}/admin/remover/${id}`, { method: 'DELETE' });
        if((await res.json()).success) { carregarMotoboysAtivos(); carregarClientes(); }
    }

    carregarDashboard();
</script>

</body>
</html>